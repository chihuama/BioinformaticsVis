<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test</title>
    <!-- Stylesheets-->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="src/css/main.css">
    <link rel="stylesheet" type="text/css" href="lib/css/d3.slider.css">

    <!-- Libraries-->
    <script   src="https://code.jquery.com/jquery-2.2.3.min.js"
              integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo="
              crossorigin="anonymous"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script src="lib/js/d3.slider.js"></script>

</head>
<body onload="start()">

<!-- Source -->
<script src="src/js/main.js"></script>
<script src="src/js/utils.js"></script>

<script src="src/js/visualizations/one_dimension.js"></script>
<script src="src/js/visualizations/two_dimension.js"></script>
<script src="src/js/visualizations/third_dimension.js"></script>

<div class="container-fluid">

    <div class="row">

        <div class="col-md-6">
            <svg id="probability"></svg>
        </div>
        <div class="col-md-6">

            <div class="row">

                <div class="col-md-6">
                    <svg id="distribution1D"></svg>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div id="timeSlider"></div>
                </div>
             </div>

        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <svg id="heatmapAB"></svg>
        </div>
        <div class="col-md-4">
            <svg id="heatmapAC"></svg>
        </div>
        <div class="col-md-4">
            <svg id="heatmapBC"></svg>
        </div>
    </div>

</div>

<script>

    /************************************************************************************/
    function start() {

        var prob_div = d3.select("#probability");

        var oneD_svg = prob_div
                .attr("width",  prob_div.node().parentNode.clientWidth )
                .attr("height", Application.main_height)
                .append('g');

        var heatmapAB_div = d3.select("#heatmapAB");
        var heatmapAC_div = d3.select("#heatmapAC");
        var heatmapBC_div = d3.select("#heatmapBC");

        var twoD_AB_svg = heatmapAB_div
                .attr("width",  heatmapAC_div.node().parentNode.clientWidth - Application.margin )
                .attr("height", Application.main_height )
                .append("g");

        var twoD_AC_svg = heatmapAC_div
                .attr("width",  heatmapAC_div.node().parentNode.clientWidth - Application.margin )
                .attr("height", Application.main_height )
                .append("g");

        var twoD_BC_svg = heatmapBC_div
                .attr("width",  heatmapBC_div.node().parentNode.clientWidth - Application.margin )
                .attr("height", Application.main_height )
                .append("g");

        var controlPanel_width = (Application.main_width- Application.margin*3) / 6;
        var controlPanel_height = Application.main_height - Application.margin*2;

//        var slider = d3.select("#timeSlider")
//                .attr("width", prob_div.node().parentNode.clientWidth / 2)
//                .attr("height",controlPanel_height / 2)
//                .append('g');

//
//        var button2_time_text = controlPanel.append("text")
//                .style("text-anchor", "left")
//                .attr("transform", "translate(" + (40+27) + "," + (25+25*5) + ")")
//                .attr("font-size", "14pt")
//                .text("Show Time Curves");
//        var button2_3rdP_text = controlPanel.append("text")
//                .style("text-anchor", "left")
//                .attr("transform", "translate(" + (40+27) + "," + (25+25*6) + ")")
//                .attr("font-size", "14pt")
//                .text("Show the 3rd Protein");
//
//        var button3_text = controlPanel.append("text")
//                .style("text-anchor", "left")
//                .attr("transform", "translate(" + 40 + "," + (25+25*7) + ")")
//                .attr("font-size", "14pt")
//                .text("3D Projecion");
//
//        var buttonPeak_text = controlPanel.append("text")
//                .style("text-anchor", "left")
//                .attr("transform", "translate(" + 40 + "," + (25+25*9) + ")")
//                .attr("font-size", "14pt")
//                .text("Show Peaks");


        /************************************************************************************/
        // 1D projection

        Application.oneDV.initialize(oneD_svg);

        // 2D projection
        var pA = Application.twoDV();
        pA.initialize(twoD_AB_svg);

        var pB = Application.twoDV();
        pB.initialize(twoD_AC_svg);

        var pC = Application.twoDV();
        pC.initialize(twoD_BC_svg);

        /************************************************************************************/
        /************************************************************************************/
        // load multiple files and draw
        queue()
        /*.defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pa_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pb_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pc_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pab_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pac_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pbc_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/Pabc_t0-20.csv")
         .defer(d3.csv, "http://localhost:8080/Desktop/BioinformaticsVis/D3/state_space.csv")
         */
                .defer(d3.csv, "Pa_t0-20.csv")
                .defer(d3.csv, "Pb_t0-20.csv")
                .defer(d3.csv, "Pc_t0-20.csv")
                .defer(d3.csv, "Pab_t0-20.csv")
                .defer(d3.csv, "Pac_t0-20.csv")
                .defer(d3.csv, "Pbc_t0-20.csv")
                .defer(d3.csv, "Pabc_t0-20.csv")
                .defer(d3.csv, "state_space.csv")
                .await(loadAll);

        function loadAll(error, Pa_t20, Pb_t20, Pc_t20, Pab_t20, Pac_t20, Pbc_t20, Pabc_t20, States) {
            if (error) {
                console.log(error);
            }

            var headerRow_states = Object.keys(States[0]);
            var headerRow_oneD = Object.keys(Pa_t20[0]);  // get keys from the first row
            var headerRow_twoD = Object.keys(Pab_t20[0]);  // get keys from the first row
            var headerRow_threeD = Object.keys(Pabc_t20[0]);

            var xMaxP = [];
            xMaxP[0] = d3.max(Pa_t20, function (d) { return +d[headerRow_oneD[0]]; });
            xMaxP[1] = d3.max(Pb_t20, function (d) { return +d[headerRow_oneD[0]]; });
            xMaxP[2] = d3.max(Pc_t20, function (d) { return +d[headerRow_oneD[0]]; });

            var xMax_oneD = d3.max(xMaxP);
            var yMax_oneD = d3.max([Application.utils.findMax(Pa_t20, headerRow_oneD, 1),
                        Application.utils.findMax(Pc_t20, headerRow_oneD, 1),
                        Application.utils.findMax(Pc_t20, headerRow_oneD, 1)]) + 0.01;

            var probMax2D = d3.max([Application.utils.findMax(Pab_t20, headerRow_twoD, 2),
                        Application.utils.findMax(Pac_t20, headerRow_twoD, 2),
                        Application.utils.findMax(Pbc_t20, headerRow_twoD, 2)]) + 0.01;

            var probMax3D = Application.utils.findMax(Pabc_t20, headerRow_threeD, 3);


//
//            var button2D_3rdP = controlPanel.append("g").append("circle")
//                    .attr("cx", 40+7)
//                    .attr("cy", 19+25*6)
//                    .attr("r", 7)
//                    .attr("fill", "white")
//                    .attr("stroke", "black")
//                    .on("click", function () {
//                        if (Application.show_projectionTwoD_3rdP) {
//                            Application.show_projectionTwoD_3rdP = false;
//                        } else {
//                            Application.show_projectionTwoD_time = false;
//                            Application.show_projectionTwoD_3rdP = true;
//                            Application.show_projectionTwoD = true;
//                        }
//                        console.log("p2_3rdP Clicked!");
//                        console.log(Application.show_projectionTwoD_3rdP);
//                        showHide();
//                    });
//
//            var button3D = controlPanel.append("g").append("circle")
//                    .attr("cx", 20)
//                    .attr("cy", 19+25*7)
//                    .attr("r", 7)
//                    .attr("fill", "white")
//                    .attr("stroke", "black")
//                    .on("click", function () {
//                        if (Application.show_projectionThreeD) {
//                            Application.show_projectionThreeD = false;
//                        } else {
//                            Application.show_projectionOneD = false;
//                            Application.show_projectionTwoD = false;
//                            Application.show_projectionTwoD_Pab = false;
//                            Application.show_projectionTwoD_Pac = false;
//                            Application.show_projectionTwoD_Pbc = false;
//                            Application.show_detailTwoD = false;
//                            Application.show_projectionThreeD = true;
//                        }
//                        console.log("p3 Clicked!");
//                        console.log(Application.show_projectionThreeD);
//                        showHide();
//                    });
//
//            var buttonPeak = controlPanel.append("g").append("circle")
//                    .attr("cx", 20)
//                    .attr("cy", 19+25*9)
//                    .attr("r", 7)
//                    .attr("fill", "white")
//                    .attr("stroke", "black")
//                    .on("click", function () {
//                        if (Application.show_peaks) {
//                            Application.show_peaks = false;
//                        } else {
//                            Application.show_peaks = true;
//                            Application.clickedPaIndex = -1;
//                            Application.clickedPbIndex = -1;
//                            Application.clickedPcIndex = -1;
//                        }
//                        console.log("peaks Clicked!");
//                        console.log(Application.show_peaks);
//                        showHide();
//                    });

            /************************************************************************************/
            // time slider
            var startingTime = 0;

            var timeX = d3.scale.linear().domain([0, Application.TimeStep-1]).range([0, controlPanel_width - Application.margin*2]).clamp(true);

            function brushed(evt, value) {

                console.log(evt);
                Application.currentTime = value;

                showHide();
            }

            d3.select('#timeSlider')
                    .call(d3.slider()
                            .axis(d3.svg.axis().ticks(Application.TimeStep-1))
                            .min(startingTime)
                            .max(Application.TimeStep-1)
                            .step(1)
                            .on("slide", brushed));

            /************************************************************************************/
            function showHide() {
                if (Application.show_projectionOneD) {
//                    button1D.attr("fill", "black");
//                    button2D.attr("fill", "white");
//                    button2D_ab.attr("fill", "white");
//                    button2D_ac.attr("fill", "white");
//                    button2D_bc.attr("fill", "white");
//                    button3D.attr("fill", "white");
//
//                    Application.oneDV.getProjection().selectAll("*").remove();
//                    Application.twoDV.getProjection().selectAll("*").remove();

                    Application.oneDV.drawAxis(xMax_oneD, yMax_oneD);  // draw X/Y-axis

                    Application.oneDV.renderLineGraphs(Pa_t20, Pb_t20, Pc_t20, headerRow_oneD);
                    Application.oneDV.renderOneDHeatMaps(Pa_t20, Pb_t20, Pc_t20, Pabc_t20, headerRow_oneD, probMax3D, xMaxP, xMax_oneD, yMax_oneD);

//                    if (Application.show_peaks) {
//                        buttonPeak.attr("fill", "black");
//                        Application.oneDV.getPeaks().selectAll("*").remove();
//                        Application.twoDV.drawPeaks(Pa_t20, Pb_t20, Pc_t20, Pabc_t20, xMaxP, probMax3D);
//                    } else {
//                        buttonPeak.attr("fill", "white");
//                        Application.oneDV.getPeaks().selectAll("*").remove();
//                    }
//                }
//                else if (Application.show_projectionTwoD_Pab && Application.show_projectionTwoD) {
//                    button1D.attr("fill", "white");
//                    button2D.attr("fill", "black");
//                    button2D_ab.attr("fill", "black");
//                    button2D_ac.attr("fill", "white");
//                    button2D_bc.attr("fill", "white");
//                    button3D.attr("fill", "white");

//                    Application.oneDV.getProjection().selectAll("*").remove();
//                    Application.oneDV.getPeaks().selectAll("*").remove();

//                    Application.twoDV.getProjection().selectAll("*").remove();
                      pA.draw2DHeatMap(Pab_t20, probMax2D, Application.currentTime, Pabc_t20);
                      pB.draw2DHeatMap(Pac_t20, probMax2D, Application.currentTime, Pabc_t20);
                      pC.draw2DHeatMap(Pbc_t20, probMax2D, Application.currentTime, Pabc_t20);

//                    if (Application.show_peaks) {
//                        buttonPeak.attr("fill", "black");
//                    } else {
//                        buttonPeak.attr("fill", "white");
//                    }
//                    if (Application.show_projectionTwoD_time) {
//                        button2D_time.attr("fill", "black");
//                    } else {
//                        button2D_time.attr("fill", "white");
//                    }
//                    if (Application.show_projectionTwoD_3rdP) {
//                        button2D_3rdP.attr("fill", "black");
//                    } else {
//                        button2D_3rdP.attr("fill", "white");
//                    }
                }
//                else if (Application.show_projectionTwoD_Pac && Application.show_projectionTwoD) {
//                    button1D.attr("fill", "white");
//                    button2D.attr("fill", "black");
//                    button2D_ab.attr("fill", "white");
//                    button2D_ac.attr("fill", "black");
//                    button2D_bc.attr("fill", "white");
//                    button3D.attr("fill", "white");
//
//                    Application.oneDV.getProjection().selectAll("*").remove();
//                    Application.oneDV.getPeaks().selectAll("*").remove();
//                    Application.twoDV.getProjection().selectAll("*").remove();
//                    Application.twoDV.draw2DHeatMap(Pac_t20, probMax2D, Application.currentTime, Pabc_t20);
//
//                    if (Application.show_peaks) {
//                        buttonPeak.attr("fill", "black");
//                    } else {
//                        buttonPeak.attr("fill", "white");
//                    }
//                    if (Application.show_projectionTwoD_time) {
//                        button2D_time.attr("fill", "black");
//                    } else {
//                        button2D_time.attr("fill", "white");
//                    }
//                    if (Application.show_projectionTwoD_3rdP) {
//                        button2D_3rdP.attr("fill", "black");
//                    } else {
//                        button2D_3rdP.attr("fill", "white");
//                    }
//                }
//                else if (Application.show_projectionTwoD_Pbc && Application.show_projectionTwoD) {
//                    button1D.attr("fill", "white");
//                    button2D.attr("fill", "black");
//                    button2D_ab.attr("fill", "white");
//                    button2D_ac.attr("fill", "white");
//                    button2D_bc.attr("fill", "black");
//                    button3D.attr("fill", "white");
//
//                    Application.oneDV.getProjection().selectAll("*").remove();
//                    Application.oneDV.getPeaks().selectAll("*").remove();
//                    Application.twoDV.getProjection().selectAll("*").remove();
//                    Application.twoDV.draw2DHeatMap(Pbc_t20, probMax2D, Application.currentTime, Pabc_t20);
//
//                    if (Application.show_peaks) {
//                        buttonPeak.attr("fill", "black");
//                    } else {
//                        buttonPeak.attr("fill", "white");
//                    }
//                    if (Application.show_projectionTwoD_time) {
//                        button2D_time.attr("fill", "black");
//                    } else {
//                        button2D_time.attr("fill", "white");
//                    }
//                    if (Application.show_projectionTwoD_3rdP) {
//                        button2D_3rdP.attr("fill", "black");
//                    } else {
//                        button2D_3rdP.attr("fill", "white");
//                    }
//                }
//                else if (Application.show_projectionThreeD) {
//                    button1D.attr("fill", "white");
//                    button2D.attr("fill", "white");
//                    button2D_ab.attr("fill", "white");
//                    button2D_ac.attr("fill", "white");
//                    button2D_bc.attr("fill", "white");
//                    button3D.attr("fill", "black");
//                    Application.oneDV.getProjection().selectAll("*").remove();
//                    Application.oneDV.getPeaks().selectAll("*").remove();
//                    Application.twoDV.getProjection().selectAll("*").remove();
//                    if (Application.show_peaks) {
//                        buttonPeak.attr("fill", "black");
//                    } else {
//                        buttonPeak.attr("fill", "white");
//                    }
//                }
//                else {
//                    button1D.attr("fill", "white");
//                    button2D.attr("fill", "white");
//                    button2D_ab.attr("fill", "white");
//                    button2D_ac.attr("fill", "white");
//                    button2D_bc.attr("fill", "white");
//                    button3D.attr("fill", "white");
//                    Application.oneDV.getProjection().selectAll("*").remove();
//                    Application.oneDV.getPeaks().selectAll("*").remove();
//                    Application.twoDV.getProjection().selectAll("*").remove();
//                }
            }

            showHide();

        }  // end - loadAll()

        /************************************************************************************/
        /*
         function type(d) {
         d.protein_num = +d.protein_num;
         d.probability = +d.probability;
         return d;
         }

         d3.csv("http://localhost:8080/Desktop/BioinformaticsVis/D3/Pa_t0-20.csv", type, function (dataset) {
         var headerRow = Object.keys(dataset[0]);
         //console.log(headerRow[1]);
         xMax = d3.max(dataset, function (d) { return +d[headerRow[0]]; });
         console.log(xMax);
         yMax = d3.max(dataset, function (d) { return +d[headerRow[1]]; });
         console.log(yMax);

         drawLineGraphs(dataset, headerRow[0], headerRow[1]);
         //drawHeatMaps(dataset);
         });*/

    }
    /************************************************************************************/
</script>


</body>
</html>